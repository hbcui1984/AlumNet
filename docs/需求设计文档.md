# AlumNet 校友会小程序 - 需求与设计文档

## 一、项目概述

### 1.1 项目背景
近年来，各大高校、高中、初中纷纷组织校友会，旨在：
- 寻找和联络优秀校友
- 建立校友与校友之间的连接
- 加强校友与母校之间的联系
- 实现资源共享，共同发展

### 1.2 项目目标
开发一个**开源版校友会小程序**，具备以下特点：
- **通用性**：适用于各类学校（高校、高中、初中等）
- **易部署**：基于 uniCloud 云开发，降低部署门槛
- **可定制**：支持学校自定义品牌、功能模块
- **开源免费**：MIT 协议开源，社区共建

### 1.3 技术选型
| 层级 | 技术方案 |
|------|----------|
| 基础框架 | **uni-starter** (云端一体应用快速开发模板) |
| 前端 | uni-app (Vue3 + TypeScript) |
| 后端 | uniCloud (云函数 + 云数据库) |
| 用户系统 | **uni-id** (已集成，开箱即用) |
| IM通讯 | **uni-im** (官方即时通讯方案) |
| 管理后台 | **uni-admin** (官方后台框架) |
| UI框架 | **uni-ui** (官方组件库，65+组件) |
| 部署平台 | 微信小程序、H5、App |

> **注意**：优先使用 uni-app 内置组件和 uni-ui，不使用第三方 UI 库

### 1.4 uni-starter 已有功能

基于 uni-starter v2.2.13，以下功能**已实现**，可直接复用：

| 模块 | 功能 | 状态 |
|------|------|:----:|
| 用户认证 | 微信登录、手机号登录、密码登录 | ✅ |
| 用户信息 | 头像、昵称、性别、生日等 | ✅ |
| 账号管理 | 修改密码、绑定手机、注销账号 | ✅ |
| 实名认证 | 身份证实名验证 | ✅ |
| 文章系统 | 列表、详情、分类、搜索、评论 | ✅ |
| 用户签到 | 连续签到、积分奖励 | ✅ |
| 意见反馈 | 反馈表单、附件上传 | ✅ |
| 短信服务 | 验证码、短信模板 | ✅ |
| 推送通知 | APP推送、设备管理 | ✅ |
| 应用升级 | 版本检测、强制更新 | ✅ |
| 数据统计 | 用户活跃、页面访问 | ✅ |
| 国际化 | 中文/英文切换 | ✅ |

**需要扩展开发的功能**：
- 校友认证（入学信息、校友推荐）
- 校友录（搜索、名片、隐私设置）
- 校友地图
- 活动模块（发布、报名、签到）
- IM通讯（集成 uni-im）
- 管理后台（集成 uni-admin）

---

## 二、用户角色

### 2.1 角色定义

| 角色 | 说明 | 核心权限 |
|------|------|----------|
| 游客 | 未注册/未登录用户 | 浏览公开信息、申请注册 |
| 校友 | 已认证的校友 | 完整功能使用 |
| 班级管理员 | 班级负责人 | 管理班级成员、发布班级动态 |
| 校友会管理员 | 校友会工作人员 | 审核校友、管理活动、发布公告 |
| 超级管理员 | 系统管理员 | 全部权限、系统配置 |

### 2.2 角色权限矩阵

| 功能 | 游客 | 校友 | 班级管理员 | 校友会管理员 | 超级管理员 |
|------|:----:|:----:|:----------:|:------------:|:----------:|
| 浏览公开动态 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 注册/登录 | ✓ | - | - | - | - |
| 完善个人信息 | - | ✓ | ✓ | ✓ | ✓ |
| 发布动态 | - | ✓ | ✓ | ✓ | ✓ |
| 查看校友录 | - | ✓ | ✓ | ✓ | ✓ |
| 参与活动 | - | ✓ | ✓ | ✓ | ✓ |
| 管理班级 | - | - | ✓ | ✓ | ✓ |
| 审核校友 | - | - | - | ✓ | ✓ |
| 发布活动 | - | - | - | ✓ | ✓ |
| 系统配置 | - | - | - | - | ✓ |

---

## 三、功能模块

### 3.1 模块总览

```
校友会小程序
├── 用户模块
│   ├── 注册/登录
│   ├── 校友认证
│   ├── 个人中心
│   └── 隐私设置
├── 校友录模块
│   ├── 校友搜索
│   ├── 校友名片
│   ├── 班级/届别浏览
│   └── 校友地图
├── 动态模块
│   ├── 动态发布
│   ├── 动态浏览
│   ├── 点赞/评论
│   └── 校友故事
├── 活动模块
│   ├── 活动列表
│   ├── 活动详情
│   ├── 活动报名
│   └── 签到打卡
├── 通讯模块
│   ├── 站内消息
│   ├── 系统通知
│   └── 公告发布
├── 捐赠模块（可选）
│   ├── 捐赠项目
│   ├── 在线捐赠
│   └── 捐赠记录
└── 管理后台
    ├── 校友管理
    ├── 活动管理
    ├── 内容审核
    └── 数据统计
```

### 3.2 核心功能详述

#### 3.2.1 用户模块

**注册/登录**
- 微信一键登录（小程序场景）
- 手机号 + 验证码登录
- 账号密码登录（可选）

**校友认证**
- 填写入学年份、毕业年份、院系、班级等信息
- 上传学历证明/学生证（可选）
- 管理员审核或自动审核（校友推荐）
- 认证状态：待审核、已认证、已拒绝

**个人中心**
- 基本信息：头像、姓名、性别、生日
- 校友信息：入学年份、毕业年份、院系、班级、学号
- 职业信息：公司、职位、行业、工作城市
- 联系方式：手机、微信、邮箱
- 个人简介、特长标签

**隐私设置**
- 可选择公开/隐藏的信息项
- 谁可以查看我的联系方式（所有人/仅同班/仅好友/不公开）

#### 3.2.2 校友录模块

**校友搜索**
- 按姓名搜索
- 按届别/年级筛选
- 按院系/班级筛选
- 按行业/公司筛选
- 按城市筛选

**校友名片**
- 展示校友公开信息
- 互加好友/交换联系方式
- 私信功能

**校友地图**
- 地图展示校友分布
- 按城市/省份统计
- 发现同城校友

#### 3.2.3 动态模块

**动态类型**
- 普通动态（图文）
- 校友故事（专题采访）
- 班级动态
- 母校新闻

**互动功能**
- 点赞
- 评论（支持回复）
- 转发/分享

#### 3.2.4 活动模块

**活动类型**
- 校庆活动
- 校友聚会
- 行业交流
- 讲座/分享会
- 公益活动

**活动功能**
- 活动发布（标题、时间、地点、介绍、报名限制）
- 活动报名（收集报名信息）
- 报名管理（审核、导出名单）
- 活动签到（扫码签到）
- 活动相册（照片上传与浏览）

#### 3.2.5 通讯模块

**消息类型**
- 系统通知（审核结果、活动提醒等）
- 私信消息
- 评论/点赞通知
- 公告通知

---

## 四、数据库设计

### 4.1 已有集合（uni-starter 提供）

| 集合名 | 说明 | 备注 |
|--------|------|------|
| uni-id-users | 用户表 | **需扩展**校友信息字段 |
| uni-id-roles | 角色表 | 复用 |
| uni-id-permissions | 权限表 | 复用 |
| opendb-news-articles | 文章/动态表 | 可用于校友动态 |
| opendb-news-comments | 评论表 | 复用 |
| opendb-news-categories | 分类表 | 复用 |

### 4.2 需扩展字段（uni-id-users）

在 `uni-id-users` 表基础上扩展以下字段：

```javascript
{
  // === uni-id 已有字段 ===
  _id, openid, unionid, phone, password,
  nickname, avatar, gender, birthday,

  // === 新增：基本信息 ===
  realName: string,         // 真实姓名

  // === 新增：教育经历（支持多段学历） ===
  educations: [
    {
      degree: string,         // 学历: bachelor/master/doctor/highschool/middleschool
      enrollmentYear: number, // 入学年份
      graduationYear: number, // 毕业年份
      studentId: string,      // 学号
      className: string,      // 班级

      // 大学专用
      college: string,        // 学院（仅大学）
      major: string,          // 专业（仅大学）

      // 中学专用
      grade: string,          // 年级（仅中学）

      isPrimary: boolean,     // 是否主要学历（用于列表展示）
    }
  ],

  // === 新增：职业信息 ===
  company: string,          // 公司
  position: string,         // 职位
  industry: string,         // 行业
  workCity: string,         // 工作城市
  workProvince: string,     // 工作省份

  // === 新增：联系方式 ===
  email: string,            // 邮箱
  wechatId: string,         // 微信号

  // === 新增：其他 ===
  bio: string,              // 个人简介
  tags: array,              // 标签（技能/兴趣）

  // === 新增：认证状态 ===
  alumniStatus: number,     // 校友认证状态: 0待认证 1已认证 2已拒绝
  alumniVerifyTime: timestamp, // 认证时间
  alumniRejectReason: string,  // 拒绝原因

  // === 新增：隐私设置 ===
  privacy: {
    showPhone: string,      // all/classmate/friend/none
    showWechat: string,
    showEmail: string,
    showCompany: string,
    showInMap: boolean,     // 是否显示在校友地图
  },
}
```

> **学历类型 degree 说明**：
> | 值 | 说明 |
> |---|------|
> | bachelor | 本科 |
> | master | 硕士 |
> | doctor | 博士 |
> | highschool | 高中 |
> | middleschool | 初中 |
>
> **多段学历示例**：
> ```javascript
> educations: [
>   { degree: "bachelor", enrollmentYear: 2010, graduationYear: 2014,
>     college: "计算机学院", major: "软件工程", isPrimary: false },
>   { degree: "master", enrollmentYear: 2014, graduationYear: 2017,
>     college: "计算机学院", major: "计算机科学", isPrimary: true }
> ]
> ```

### 4.3 新增集合

#### alumni-recommendations - 校友推荐表
```javascript
{
  _id: string,
  targetUserId: string,     // 被推荐人ID
  recommenderUserId: string, // 推荐人ID
  relationship: string,     // 关系说明（同班/同院/认识等）
  createTime: timestamp,
}
// 规则：同一人不能重复推荐，达到N人推荐自动通过认证
```

#### alumni-activities - 活动表
```javascript
{
  _id: string,
  title: string,            // 活动标题
  cover: string,            // 封面图
  content: string,          // 活动详情（富文本）
  type: string,             // 活动类型: reunion/lecture/exchange/charity

  startTime: timestamp,     // 开始时间
  endTime: timestamp,       // 结束时间
  signupDeadline: timestamp,// 报名截止时间

  location: string,         // 活动地点
  address: string,          // 详细地址
  longitude: number,        // 经度
  latitude: number,         // 纬度

  maxParticipants: number,  // 人数上限（0为不限）
  currentParticipants: number, // 当前报名人数
  fee: number,              // 费用（0为免费）

  organizerId: string,      // 组织者ID
  status: number,           // 状态: 0草稿 1报名中 2进行中 3已结束

  createTime: timestamp,
  updateTime: timestamp,
}
```

#### alumni-signups - 活动报名表
```javascript
{
  _id: string,
  activityId: string,       // 活动ID
  userId: string,           // 用户ID

  name: string,             // 报名姓名
  phone: string,            // 联系电话
  remark: string,           // 备注

  status: number,           // 状态: 0待审核 1已通过 2已拒绝 3已取消
  checkinTime: timestamp,   // 签到时间

  createTime: timestamp,
}
```

#### alumni-school-config - 学校配置表
```javascript
{
  _id: string,
  name: string,             // 学校名称
  logo: string,             // 学校Logo
  type: string,             // 类型: university/highschool/middleschool

  // === 大学组织结构 ===
  degrees: [string],        // 支持的学历层次（仅大学），如 ["bachelor","master","doctor"]
  colleges: [               // 学院列表（仅大学）
    {
      name: string,         // 学院名称
      majors: [string]      // 专业列表
    }
  ],

  // === 中学组织结构 ===
  grades: [string],         // 年级列表（仅中学），如 ["高一","高二","高三"]

  config: {
    recommendCount: number,     // 推荐认证所需人数（默认3，超过此数自动通过）
    enableAutoVerify: boolean,  // 启用推荐自动认证（默认true）
  },

  createTime: timestamp,
  updateTime: timestamp,
}
```

> **组织结构示例**：
> ```javascript
> // 大学示例（支持本硕博）
> {
>   type: "university",
>   degrees: ["bachelor", "master", "doctor"],
>   colleges: [
>     { name: "计算机学院", majors: ["软件工程", "计算机科学", "人工智能"] },
>     { name: "商学院", majors: ["工商管理", "市场营销", "会计学"] }
>   ]
> }
>
> // 高中示例
> { type: "highschool", grades: ["高一", "高二", "高三"] }
>
> // 初中示例
> { type: "middleschool", grades: ["初一", "初二", "初三"] }
> ```

---

## 五、页面设计

### 5.1 已有页面（uni-starter 提供）

| 页面 | 路径 | 说明 |
|------|------|------|
| 列表页 | pages/list/list | 可改造为动态列表 |
| 详情页 | pages/list/detail | 可复用 |
| 搜索页 | pages/list/search | 可复用 |
| 宫格页 | pages/grid/grid | 可改造为功能入口 |
| 用户中心 | pages/ucenter/ucenter | 需扩展校友信息 |
| 设置页 | pages/ucenter/settings | 可复用 |
| 登录页 | uni-id-pages | 已完整实现 |
| 用户信息 | uni-id-pages/userinfo | 需扩展校友字段 |

### 5.2 需新增页面

```
pages/
├── alumni/                 # 校友录（新增）
│   ├── list.vue           # 校友列表（搜索、筛选）
│   ├── detail.vue         # 校友名片详情
│   └── map.vue            # 校友地图（P2）
├── verify/                 # 校友认证（新增）
│   ├── index.vue          # 认证首页/状态
│   ├── form.vue           # 认证表单（填写入学信息）
│   └── recommend.vue      # 邀请校友推荐
├── activity/               # 活动模块（新增）
│   ├── list.vue           # 活动列表
│   ├── detail.vue         # 活动详情
│   ├── signup.vue         # 报名表单
│   └── checkin.vue        # 扫码签到
├── privacy/                # 隐私设置（新增）
│   └── index.vue          # 隐私控制页
└── 改造已有页面
    ├── ucenter/ucenter    # 扩展校友信息展示
    ├── grid/grid          # 改造为功能宫格入口
    └── list/list          # 改造为校友动态
```

### 5.3 底部导航（调整）

| Tab | 图标 | 页面 | 说明 |
|-----|------|------|------|
| 首页 | home | pages/list/list | 校友动态 |
| 校友录 | contact | pages/alumni/list | **新增** |
| 活动 | calendar | pages/activity/list | **新增** |
| 消息 | chat | uni-im 页面 | 集成 uni-im |
| 我的 | person | pages/ucenter/ucenter | 扩展 |

---

## 六、接口设计

### 6.1 云函数列表

| 云函数 | 说明 |
|--------|------|
| user-center | 用户相关（登录、注册、认证、信息更新） |
| alumni | 校友录相关（查询、搜索、统计） |
| post | 动态相关（发布、列表、详情、互动） |
| activity | 活动相关（列表、详情、报名、签到） |
| message | 消息相关（列表、发送、已读） |
| admin | 管理后台（审核、统计、配置） |
| common | 通用功能（上传、验证码等） |

---

## 七、待讨论事项

### 7.1 功能优先级（已调整）

基于 uni-starter 已有功能，重新划分开发优先级：

**已完成（uni-starter 提供）**：
| 功能 | 来源 | 备注 |
|------|------|------|
| 用户注册/登录 | uni-id-pages | 微信、手机号、密码登录 |
| 个人信息管理 | uni-id-pages | 头像、昵称、基础信息 |
| 账号安全 | uni-id-pages | 改密、绑定、注销 |
| 动态/文章系统 | uni-starter | 列表、详情、评论 |
| 短信/推送 | uni-starter | 验证码、消息推送 |

**需要开发**：
| 优先级 | 功能模块 | 说明 | 工作量 |
|:------:|----------|------|:------:|
| **P0** | 校友认证 | 扩展 uni-id-users 表，增加入学信息字段 | 中 |
| **P0** | 校友推荐认证 | 新增推荐表，实现推荐认证逻辑 | 中 |
| **P0** | 校友录 | 校友列表、搜索、筛选、名片页 | 中 |
| **P0** | 隐私设置 | 控制信息可见范围 | 小 |
| **P1** | 活动模块 | 活动发布、报名、签到 | 大 |
| **P1** | IM通讯 | 集成 uni-im（私聊+群聊） | 中 |
| **P1** | 管理后台 | 集成 uni-admin，校友审核等 | 大 |
| **P2** | 校友地图 | 地图展示校友分布 | 中 |
| **P2** | 学校配置 | Logo、院系、认证规则等 | 小 |

### 7.2 开放讨论

1. **多学校支持**：~~是否需要支持一套系统部署多个学校？还是每个学校独立部署？~~
   > ✅ 已确认：**每校独立部署**，每个学校拥有独立的 uniCloud 服务空间

2. **认证方式**：~~除了人工审核，是否需要其他认证方式？~~
   > ✅ 已确认：**人工审核 + 校友推荐** 双通道
   > - 通道一：管理员人工审核
   > - 通道二：已认证校友推荐，**累计超过3人推荐自动通过**

3. **社交深度**：~~是否需要好友关系？是否需要群聊功能？~~
   > ✅ 已确认：**好友关系 + 群聊功能**，基于 **uni-im** 实现
   > - 参考文档：https://doc.dcloud.net.cn/uniCloud/uni-im.html
   > - 单聊：校友间私信
   > - 群聊：班级群、活动群、兴趣群等
   > - 消息类型：文本、图片、语音等

4. **管理后台**：~~小程序内嵌管理页面？独立H5管理后台？~~
   > ✅ 已确认：基于 **uni-admin** 官方后台框架
   > - 参考文档：https://doc.dcloud.net.cn/uniCloud/admin.html
   > - PC/H5 管理后台，功能完整
   > - 与 uniCloud 深度集成，开发效率高

5. **其他功能建议**：~~校友企业黄页、求职/招聘板块、校友问答、班级相册~~
   > ✅ 已确认：**MVP 阶段暂不实现**，专注核心功能
   > - 后续版本可考虑：企业黄页、招聘、问答、相册、捐赠等

---

## 八、项目里程碑

| 阶段 | 目标 | 核心功能 |
|------|------|----------|
| **MVP** | 校友认证 + 校友录 | 扩展用户表、校友认证流程、校友推荐、校友列表/搜索/名片 |
| **V1.0** | 活动 + IM | 活动发布/报名/签到、集成 uni-im |
| **V1.5** | 管理后台 | 集成 uni-admin、校友审核、数据统计 |
| **V2.0** | 增值功能 | 校友地图、学校配置、多平台适配优化 |

---

*文档版本: v0.2*
*最后更新: 2026-01-12*
*基于: uni-starter v2.2.13*
